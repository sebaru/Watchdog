/* 000006.dls: Eclairage PCC du Salon */

 /* Bits de consommation du module */
 #static POS_TL         <-> _E0002; /* Position du Télérupteur des luminaires centre Salon */
 #define O_TLSALON_ON   <-> _M(libelle="Demande d'allumage TL"); /* Ordre TL Salon ON */
 #define O_TLSALON_OFF  <-> _M(libelle="Demande d'extinction TL"); /* Ordre TL Salon OFF */

 /* Bits de production du module */
 #static ACT_TL         <-> _A0002; /* Sortie physique de pilotage du télérupteur, Ex: Legrand 412412 */
 #define MDEF_REPOS     <-> _B(libelle="Defaut Repos TL");       /* Mémorisation du défaut repos non acquitté du TL */
 #define MDEF_REPOS_F   <-> _B(libelle="Defaut Repos Fixe TL");   /* Mémorisation du défaut repos acquitté (Fixe) du TL */
 #define MDEF_TRAVAIL   <-> _B(libelle="Defaut Travail TL");      /* Mémorisation du défaut travail non acquitté du TL */
 #define MDEF_TRAVAIL_F <-> _B(libelle="Defaut Travail Fixe TL"); /* Mémorisation du défaut travail acquitté (Fixe) du TL */
 #static MSG_TELE_ON    <-> _MSG0005; /* Lumière allumée */
 #static MSG_DEF_REPOS  <-> _MSG0006; /* Defaut repos */
 #static MSG_DEF_TRAVAIL<-> _MSG0007; /* Defaut travail */

 /* Bits purement internes au module */
 #define MEWANTTL       <-> _B(libelle="Etat attendu du TL 0=ouvert 1=ferme");
 #define MEACTELE       <-> _B(libelle="Demande de manoeuvre du TL changement d'etat");
 #define TR_DEF         <-> _T(daa=20,dma=0,dMa=0,dad=0,libelle="Temporisation de detection de defaut apres manoeuvre");
 #define TR_IMP         <-> _T(daa=0, dma=0,dMa=3,dad=0,libelle="Temporisation d'impulsion pour manoeuvrer le telerupteur");

 #define M_TEST <-> _M;
 #define M_RESULT <-> _M;
 #define T_TEST <-> _T(daa=100);

 - M_TEST -> T_TEST;
 - T_TEST -> M_RESULT;
                                    /*******************************************/
 /***********************************                 EVENEMENTS                ***********************************/
                                    /*******************************************/
 /* Start */

 - _START -> /ACT_TL, /MDEF_REPOS;

 /* DEFAUTS */
  - POS_TL . TR_DEF ./MDEF_REPOS_F
                               -> MDEF_REPOS;                         /* Détection Discordance Repos du Télérupteur */
  - _OSYN_ACQUIT . MDEF_REPOS  ->/MDEF_REPOS, MDEF_REPOS_F;                                     /* Acquit du défaut */
  -/POS_TL . MDEF_REPOS_F      ->/MDEF_REPOS_F;                                            /* Suppression du défaut */
 
  -/POS_TL . TR_DEF ./MDEF_TRAVAIL_F
                                -> MDEF_TRAVAIL;                   /* Détection Discordance Travail du Télérupteur */
  - _OSYN_ACQUIT . MDEF_TRAVAIL ->/MDEF_TRAVAIL, MDEF_TRAVAIL_F;                               /* Acquit du défaut */
  - POS_TL . MDEF_TRAVAIL_F     ->/MDEF_TRAVAIL_F;                                        /* Suppression du défaut */
 
                                    /*******************************************/
 /***********************************        SYNTHESES DEFAUTS ET ALARMES       ***********************************/
                                    /*******************************************/
 /* SYNTHESES DEFAUTS ---------------------------------------------------------*/
 /* DEFAUTS */
  - MDEF_REPOS + MDEF_TRAVAIL     -> _MEMSA_DEFAUT;
 
 /* DEFAUTS FIXES */
  - MDEF_REPOS_F + MDEF_TRAVAIL_F -> _MEMSA_DEFAUT_FIXE;
 
                                    /*******************************************/
 /***********************************              FONCTIONS PILOTEES           ***********************************/
                                    /*******************************************/
 
 /* ORDRES DU MODULE ----------------------------------------------------------*/
 
 /* CALCUL ETAT ATTENDU TELERUPTEUR */
  - /_MEMSA_DOWN .  O_TLSALON_ON . /POS_TL -> MEWANTTL, MEACTELE;
  - /_MEMSA_DOWN .  O_TLSALON_OFF.  POS_TL ->/MEWANTTL, MEACTELE;
 
 /* PILOTAGE TELE SUR COMMANDE DE MANOEUVRE */
  - MEACTELE -> TR_IMP, TR_DEF;
  - TR_IMP   -> ACT_TL;
  -/TR_IMP   ->/ACT_TL;
 
 /* FIN DE MANOEUVRE */
  - MEWANTTL .  POS_TL -> /MEACTELE;
  -/MEWANTTL . /POS_TL -> /MEACTELE;


                                    /*******************************************/
 /***********************************              MESSAGES IMPRIMANTES         ***********************************/
                                    /*******************************************/
  - POS_TL                        -> MSG_TELE_ON;
  - MDEF_REPOS + MDEF_REPOS_F     -> MSG_DEF_REPOS;
  - MDEF_TRAVAIL + MDEF_TRAVAIL_F -> MSG_DEF_TRAVAIL;

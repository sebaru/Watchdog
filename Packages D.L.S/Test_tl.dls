/* 000006.dls: Eclairage PCC du  */

 /* Bits de consommation du module */
 #define POS_TL         <-> _E(libelle="Position Télérupteur"); /* Position du Télérupteur des luminaires centre  */
 #define OSMS_TL_ON     <-> _E(libelle="Demande SMS d'allumage TL"); /* Ordre TL  ON */
 #define OSMS_TL_OFF    <-> _E(libelle="Demande SMS d'extinction TL"); /* Ordre TL  OFF */
 #define ODLS_TL_OFF    <-> _M(libelle="Demande DLS d'extinction TL");
 #define ODLS_TL_ON     <-> _M(libelle="Demande DLS d'allumage TL");
 #define OVOC_TL_OFF    <-> _E(libelle="Demande VOCALE d'extinction TL");
 #define OVOC_TL_ON     <-> _E(libelle="Demande VOCALE d'allumage TL");

 /* Bits de production du module */
 #define ACT_TL         <-> _A(libelle="Sortie physique de pilotage du télérupteur");
 #define MDEF_REPOS     <-> _B(libelle="Mémorisation du défaut repos non acquitté du TL");
 #define MDEF_REPOS_F   <-> _B(libelle="Mémorisation du défaut repos acquitté (Fixe) du TL");
 #define MDEF_TRAVAIL   <-> _B(libelle="Mémorisation du défaut travail non acquitté du TL");
 #define MDEF_TRAVAIL_F <-> _B(libelle="Mémorisation du défaut travail acquitté (Fixe) du TL");
 #define MSG_TELE_ON    <-> _MSG(type=etat,libelle="Allumé"); /* TL activé */
 #define MSG_DEF_REPOS  <-> _MSG(type=defaut,libelle="Défaut repos"); /* Defaut repos */
 #define MSG_DEF_TRAVAIL<-> _MSG(type=defaut,libelle="Défaut travail"); /* Defaut travail */

 /* Bits purement internes au module */
 #define MEWANTTL       <-> _B(libelle="Etat attendu du TL (0=ouvert, 1=fermé)");
 #define MEACTELE       <-> _B(libelle="Demande de manoeuvre du TL (changement d'état)");
 #define TR_DEF         <-> _T(daa=20,dma=0,dMa=0,dad=0,libelle="Temporisation de détection de défaut après manoeuvre");
 #define TR_IMP         <-> _T(daa= 0,dma=0,dMa=3,dad=0,libelle="Temporisation d'impulsion pour manoeuvrer le télérupteur");

                                    /*******************************************/
 /***********************************                 EVENEMENTS                ***********************************/
                                    /*******************************************/
 /* Start */

 - _START -> /ACT_TL, /MEWANTTL, /MEACTELE,
             /MDEF_REPOS, /MDEF_REPOS_F,
             /MDEF_TRAVAIL, /MDEF_TRAVAIL_F;

 /* DEFAUTS */
  - POS_TL . TR_DEF ./MDEF_REPOS_F
                             -> MDEF_REPOS;                         /* Détection Discordance Repos du Télérupteur */
  - _OSYN_ACQUIT . MDEF_REPOS ->/MDEF_REPOS, MDEF_REPOS_F;                                    /* Acquit du défaut */
  -/POS_TL . MDEF_REPOS_F    ->/MDEF_REPOS_F;                                            /* Suppression du défaut */

  -/POS_TL . TR_DEF ./MDEF_TRAVAIL_F
                               -> MDEF_TRAVAIL;                   /* Détection Discordance Travail du Télérupteur */
  - _OSYN_ACQUIT . MDEF_TRAVAIL ->/MDEF_TRAVAIL, MDEF_TRAVAIL_F;                              /* Acquit du défaut */
  - POS_TL . MDEF_TRAVAIL_F    ->/MDEF_TRAVAIL_F;                                        /* Suppression du défaut */

                                    /*******************************************/
 /***********************************        SYNTHESES DEFAUTS ET ALARMES       ***********************************/
                                    /*******************************************/
 /* SYNTHESES DEFAUTS ---------------------------------------------------------*/
 /* DEFAUTS */
  - MDEF_REPOS + MDEF_TRAVAIL     -> _MEMSA_DEFAUT;

 /* DEFAUTS FIXES */
  - MDEF_REPOS_F + MDEF_TRAVAIL_F -> _MEMSA_DEFAUT_FIXE;

                                    /*******************************************/
 /***********************************              FONCTIONS PILOTEES           ***********************************/
                                    /*******************************************/

 /* ORDRES DU MODULE ----------------------------------------------------------*/

 /* CALCUL ETAT ATTENDU TELERUPTEUR */
  - _MEMSA_UP. (OSMS_TL_ON  + ODLS_TL_ON  + OVOC_TL_ON ). /POS_TL -> MEWANTTL, MEACTELE;
  - _MEMSA_UP. (OSMS_TL_OFF + ODLS_TL_OFF + OVOC_TL_OFF).  POS_TL ->/MEWANTTL, MEACTELE;

 /* PILOTAGE TELE SUR COMMANDE DE MANOEUVRE */
  - MEACTELE -> TR_IMP, TR_DEF;
  - TR_IMP   -> ACT_TL;
  -/TR_IMP   ->/ACT_TL;

 /* FIN DE MANOEUVRE */
  - MEWANTTL .  POS_TL -> /MEACTELE;
  -/MEWANTTL . /POS_TL -> /MEACTELE;


                                    /*******************************************/
 /***********************************              MESSAGES IMPRIMANTES         ***********************************/
                                    /*******************************************/
  - POS_TL                        -> MSG_TELE_ON;
  - MDEF_REPOS + MDEF_REPOS_F     -> MSG_DEF_REPOS;
  - MDEF_TRAVAIL + MDEF_TRAVAIL_F -> MSG_DEF_TRAVAIL;
